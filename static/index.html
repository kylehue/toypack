<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body style="margin:0; padding:0; width: 100vw; height: 100vh;">
		<button id="bundle" style="position: absolute;">Bundle</button>
		<iframe id="sandbox" style="width: 100%; height: 100%;"></iframe>
		<script type="module">
			let toypack = new Toypack.default({
				bundleOptions: {
					mode: "development",
					entry: "src",
					output: {
						path: "lib",
						filename: "path/to/[base]",
						assetFilename: "my/cool/assets/[dir][base]",
						name: "CoolLibrary",
						asset: "external",
						sourceMap: "inline-cheap-sources",
					},
					resolve: {
						alias: {
							"@scripts": "./scripts/",
							"@stuff": "./cool/stuff/"
						},
						fallback: {
							fs: false
						}
					}
				}
			});

			(async () => {

				/* await toypack.addDependency("vue@3.2.23");
				await toypack.addDependency("uuid");
				await toypack.addDependency("react");
				await toypack.addDependency("react-dom");
				await toypack.addDependency("use-state-in-custom-properties"); */
				//await toypack.addDependency("bootstrap");
				//await toypack.addDependency("bootstrap@5.2.3/dist/css/bootstrap.min.css");

				await toypack.packageManager.install("bootstrap@5.2.3/dist/css/bootstrap.min.css");
				await toypack.packageManager.install("vue@3.2.23");
				//await toypack.packageManager.install("react");
				await toypack.packageManager.install("react-dom/client");
				
				let sampleSimpleAssets = {
					"src/index.js": `import { PI } from "@scripts/PI";
import pkg from "../package";
import "../styles/main";
import { stuff } from "@stuff/here/TheStuff";
import confetti from "https://cdnjs.cloudflare.com/ajax/libs/canvas-confetti/1.6.0/confetti.min.js";
import coolImg from "../assets/sample.jpg";
import logo from "../public/logo.svg";
import { createApp } from "vue";
//import "../react/main.jsx";
console.log(createApp);
import process from "process";
console.log(process);
/* import path, { dirname } from "path";
import { v4 } from "uuid";
import fs from "fs";
console.log(fs);
//import "bootstrap/dist/css/bootstrap.min.css";
console.log(path, dirname("path/to/some/file.txt"));
console.log(v4()); */
console.log(coolImg, logo);
console.log(confetti);
console.log(pkg);
console.log(PI, stuff);`,

					"scripts/PI.js": `import Circle from "./Circle";
import coolImage from "https://cdn.pixabay.com/photo/2016/04/13/09/19/curious-1326327_960_720.jpg";
console.log(coolImage);
export const PI = 3.14;`,

					"scripts/Circle.js": `export default class Circle {}`,

					"styles/colors.css": `:root {
	--accent: yellow;
	--bg: black;
}`,

"cool/stuff/here/TheStuff.js": 
`
import { PI } from "@scripts/PI";
export const stuff = PI + 20;
`,

"styles/main.css": `@import "./colors";

body {
	background-image: url("https://cdn.pixabay.com/photo/2016/04/13/09/19/curious-1326327_960_720.jpg");
	color: var(--accent);
}

div {
	background-image: url("../assets/sample.jpg");
}`,

"react/main.jsx": `
import React from "react";
import ReactDOM from 'react-dom/client';
import App from './App.jsx'
let root = document.createElement("div");
root.setAttribute("id", "root");
document.body.appendChild(root);
ReactDOM.createRoot(document.querySelector("#root")).render(
	<React.StrictMode>
	<App />
	</React.StrictMode>
);
`,

"react/App.jsx": `
import {useState} from 'react';
export default function App() {
	console.log(useState);
   const greet = "hello!";
   let [count, setCount] = useState(0);
   return (
      <div>
         <span>{ greet + " " + count }</span>
         <button onClick={() => setCount(count + 1)}>click me!</button>
      </div>
   )
}
`,

					"package.json": JSON.stringify({
						main: "src/index.js",
						author: "jeff"
					}),

					"assets/sample.jpg": await (
						await fetch(
							"https://cdn.pixabay.com/photo/2016/04/13/09/19/curious-1326327_960_720.jpg"
						)
					).arrayBuffer(),

					"public/logo.svg": "",
				};

				for (let [source, content] of Object.entries(sampleSimpleAssets)) {
					await toypack.addAsset(source, content);
				}

				await toypack.bundle();

			})();
			let button = document.getElementById("bundle");
			let sandbox = document.getElementById("sandbox");

			button.onclick = async () => {
				let bundle = await toypack.bundle();
				sandbox.src = bundle.contentDocURL;
			}

			window.toypack = toypack;
			console.log(toypack);
		</script>
	</body>
</html>
